{{- $index := slice -}}
{{- $pages := where .Site.RegularPages "Type" "not in"  (slice "page" "json" "api" ) -}}
{{- range $i, $e := $pages -}}
{{- $img := partial "funcs/get-bundle-image.html" . -}}
{{- $thumb := $img.Fill "640x400" -}}
{{- $firstPublishedTime := (time (.Params.published | default 0)).Unix -}}
{{- $category := .Params.category -}}
{{- $tags := .Keywords -}}
{{- $sections := slice -}}
{{- $section :=  replace .SectionsPath "/" " > " }}
{{- if ne .Section "products" -}}
{{- $section = printf "docs > %s"  $section -}}
{{- $sections = $sections | append  "docs" -}}
{{ end }}
{{- $dict := (dict "objectID" .File.UniqueID "thumbnailUrl" $thumb.RelPermalink "section" $section "category" $category "tags" $tags "excerpt" (.Params.description | default .Summary) "title"  .Title "href" .RelPermalink "lastUpdatedTime" .Lastmod.Unix "firstPublishedTime" $firstPublishedTime "keywords" .Params.keywords "deprecated" .Params.deprecated "hiddenguide" .Params.hiddenguide "h1" .Params.h1_title "toc" (.TableOfContents | plainify )) }}
{{- $dict = $dict | merge (dict "skillLevel" .Params.skillLevel "languages" .Params.languages) -}}
{{- $sectionPath := "" -}}
{{- $sections = $sections | append .SectionsEntries  -}}
{{- range $i, $section := $sections -}}
{{- if not $sectionPath -}}
{{- $sectionPath = $section -}}
{{- else -}}
{{- $sectionPath = (printf "%s > %s" $sectionPath $section) -}}
{{- end -}}
{{-  $dict = $dict | merge (dict (printf "section.lvl%d" $i) $sectionPath) -}}
{{- end -}}
{{- $index = $index | append $dict -}}
{{- end -}}
{{- $index | jsonify (dict "indent" "  ")  -}}